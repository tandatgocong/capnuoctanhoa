
SELECT * FROM TB_DULIEUKHACHHANG 
WHERE YEAR(ISNULL(NGAYKIEMDINH,NGAYTHAY)) NOT IN (2013,2014,2015,2016) AND LEFT(replace(HIEUDH,' ',''),3)='ELS'


SELECT DANHBO
FROM dbo.TB_DULIEUKHACHHANG kh 
WHERE LEFT(replace(kh.HIEUDH,' ',''),3) not in  (select HIEUDH from TB_HIEUDONGHO)


SELECT hdh.TENDONGHO,CODH,COUNT(*) AS TONGSO,
COUNT(CASE WHEN YEAR(ISNULL(NGAYKIEMDINH,NGAYTHAY)) >=2012 and  YEAR(ISNULL(NGAYKIEMDINH,NGAYTHAY)) <=2016  THEN 1 ELSE NULL END) AS CONHL,
COUNT(*) - COUNT(CASE WHEN YEAR(ISNULL(NGAYKIEMDINH,NGAYTHAY)) >=2012 and  YEAR(ISNULL(NGAYKIEMDINH,NGAYTHAY)) <=2016  THEN 1 ELSE NULL END)  as HETGL
FROM dbo.TB_DULIEUKHACHHANG kh,TB_HIEUDONGHO hdh
WHERE LEFT(replace(kh.HIEUDH,' ',''),3)=hdh.HIEUDH 
GROUP BY hdh.TENDONGHO,CODH 
ORDER BY  hdh.TENDONGHO asc,CODH ASC


SELECT hdh.TENDONGHO,CODH,COUNT(*) AS TONGSO,
COUNT(CASE WHEN ((YEAR(CURRENT_TIMESTAMP) -YEAR(NGAYTHAY)) <4)  THEN 1 ELSE NULL END) AS CONHL,
COUNT(*) - COUNT(CASE WHEN ((YEAR(CURRENT_TIMESTAMP) -YEAR(NGAYTHAY)) <4)  THEN 1 ELSE NULL END)  as HETGL
FROM dbo.TB_DULIEUKHACHHANG kh,TB_HIEUDONGHO hdh
WHERE LEFT(replace(kh.HIEUDH,' ',''),3)=hdh.HIEUDH 
GROUP BY hdh.TENDONGHO,CODH 
ORDER BY  hdh.TENDONGHO asc,CODH ASC


----------

SELECT CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15') 
                      THEN 'TB01' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30') 
                      THEN 'TB02' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50') 
                      THEN 'TP01' ELSE 'TP02' END END END AS TODS,                      
 SUBSTRING(LOTRINH,1,2) as 'DOT',kh.LOTRINH, kh.DANHBO, kh.HOPDONG, kh.HOTEN, kh.SONHA, kh.TENDUONG,kh.HIEUDH,
  kh.CODH,SOTHANDH,  CONVERT(VARCHAR(50),ngaythay,103) AS 'NGAYTHAY' , CONVERT(VARCHAR(50),NGAYKIEMDINH,103) as 'NGAY KD'
FROM  TB_DULIEUKHACHHANG kh
WHERE  NGAYKIEMDINH IS NULL
order by kh.LOTRINH asc


SELECT CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15') 
                      THEN 'TB01' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30') 
                      THEN 'TB02' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50') 
                      THEN 'TP01' ELSE 'TP02' END END END AS TODS,COUNT(*)
FROM  TB_DULIEUKHACHHANG kh
WHERE  YEAR(kh.NGAYTHAY)<2012
group by CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15') 
                      THEN 'TB01' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30') 
                      THEN 'TB02' ELSE CASE WHEN SUBSTRING(LOTRINH, 3, 2) IN ('31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50') 
                      THEN 'TP01' ELSE 'TP02' END END END




